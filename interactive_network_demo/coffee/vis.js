(function(){var t,r,n,e;e="undefined"!=typeof exports&&null!==exports?exports:this,r=function(){var t,r,n,e,u,o,a,i,c,s;return s=d3.map(),n=20,a=200,t={x:0,y:0},c=-120,r=c,o=function(t,r,n){var e,u;return e=t.x+n*Math.cos(r*Math.PI/180),u=t.y+n*Math.sin(r*Math.PI/180),{x:e,y:u}},u=function(t){var r;return r=s.get(t),s.has(t)||(r=e(t)),r},e=function(e){var u;return u=o(t,r,a),s.set(e,u),r+=n,u},i=function(t){var r,u,o;return s=d3.map(),r=360/n,t.length<r&&(n=360/t.length),u=t.slice(0,r),u.forEach(function(t){return e(t)}),o=t.slice(r),a+=a/1.8,n=360/o.length,o.forEach(function(t){return e(t)})},u.keys=function(t){return arguments.length?(i(t),u):d3.keys(s)},u.center=function(r){return arguments.length?(t=r,u):t},u.radius=function(t){return arguments.length?(a=t,u):a},u.start=function(t){return arguments.length?(c=t,r=c,u):c},u.increment=function(t){return arguments.length?(n=t,u):n},u},t=function(){var t,n,e,u,o,a,i,c,s,l,f,d,h,g,p,v,y,k,x,m,w,E,M,z,A,S,b,L,j,D,F,T,q,C,I,P,_,R,B;return B=960,f=800,t=[],e=[],u=[],p={},z=null,v=null,w=null,g=null,h="force",o="all",F="songs",l=null,c=d3.layout.force(),E=d3.scale.category20(),C=Tooltip("vis-tooltip",230),n=function(t){return-Math.pow(t.radius,2)/2},m=function(r,n){var e;return t=j(n),e=d3.select(r).append("svg").attr("width",B).attr("height",f),v=e.append("g").attr("id","links"),z=e.append("g").attr("id","nodes"),c.size([B,f]),b("force"),S("all"),I()},I=function(){var r;return u=i(t.nodes),e=a(t.links,u),"radial"===h&&(r=T(u,e),P(r)),c.nodes(u),R(),"force"===h?(c.links(e),_()):(c.links([]),g&&(g.data([]).exit().remove(),g=null)),c.start()},m.toggleLayout=function(t){return c.stop(),b(t),I()},m.toggleFilter=function(t){return c.stop(),S(t),I()},m.toggleSort=function(t){return c.stop(),L(t),I()},m.updateSearch=function(t){var r;return r=new RegExp(t.toLowerCase()),w.each(function(n){var e,u;return e=d3.select(this),u=n.name.toLowerCase().search(r),t.length>0&&u>=0?(e.style("fill","#F38630").style("stroke-width",2).style("stroke","#555"),n.searched=!0):(n.searched=!1,e.style("fill",function(t){return E(t.artist)}).style("stroke-width",1))})},m.updateData=function(r){return t=j(r),g.remove(),w.remove(),I()},j=function(t){var r,n,e;return n=d3.extent(t.nodes,function(t){return t.size}),r=d3.scale.sqrt().range([3,12]).domain(n),t.nodes.forEach(function(t){var n;return t.x=n=Math.floor(Math.random()*B),t.y=n=Math.floor(Math.random()*f),t.radius=r(t.size)}),e=y(t.nodes),t.links.forEach(function(t){return t.source=e.get(t.source),t.target=e.get(t.target),p[""+t.source.id+","+t.target.id]=1}),t},y=function(t){var r;return r=d3.map(),t.forEach(function(t){return r.set(t.id,t)}),r},M=function(t,r){var n;return n={},t.forEach(function(t){var e;return null==n[e=t[r]]&&(n[e]=0),n[t[r]]+=1}),n},x=function(t,r){return p[t.id+","+r.id]||p[r.id+","+t.id]},i=function(t){var r,n,e;return n=t,("popular"===o||"obscure"===o)&&(e=t.map(function(t){return t.size}).sort(d3.ascending),r=d3.quantile(e,.5),n=t.filter(function(t){return"popular"===o?t.size>r:"obscure"===o?t.size<=r:void 0})),n},T=function(t,r){var n,e;return n=[],"links"===F?(e={},r.forEach(function(t){var r,n;return null==e[r=t.source.artist]&&(e[r]=0),e[t.source.artist]+=1,null==e[n=t.target.artist]&&(e[n]=0),e[t.target.artist]+=1}),t.forEach(function(t){var r;return null!=e[r=t.artist]?e[r]:e[r]=0}),n=d3.entries(e).sort(function(t,r){return r.value-t.value}),n=n.map(function(t){return t.key})):(e=M(t,"artist"),n=d3.entries(e).sort(function(t,r){return r.value-t.value}),n=n.map(function(t){return t.key})),n},P=function(t){return"radial"===h?l=r().center({x:B/2,y:f/2-100}).radius(300).increment(18).keys(t):void 0},a=function(t,r){return r=y(r),t.filter(function(t){return r.get(t.source.id)&&r.get(t.target.id)})},R=function(){return w=z.selectAll("circle.node").data(u,function(t){return t.id}),w.enter().append("circle").attr("class","node").attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",function(t){return t.radius}).style("fill",function(t){return E(t.artist)}).style("stroke",function(t){return q(t)}).style("stroke-width",1),w.on("mouseover",D).on("mouseout",d),w.exit().remove()},_=function(){return g=v.selectAll("line.link").data(e,function(t){return""+t.source.id+"_"+t.target.id}),g.enter().append("line").attr("class","link").attr("stroke","#ddd").attr("stroke-opacity",.8).attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),g.exit().remove()},b=function(t){return h=t,"force"===h?c.on("tick",s).charge(-200).linkDistance(50):"radial"===h?c.on("tick",A).charge(n):void 0},S=function(t){return o=t},L=function(t){return F=t},s=function(t){return w.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),g.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y})},A=function(t){return w.each(k(t.alpha)),w.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),t.alpha<.03?(c.stop(),_()):void 0},k=function(t){var r;return r=.1*t,function(t){var n;return n=l(t.artist),t.x+=(n.x-t.x)*r,t.y+=(n.y-t.y)*r}},q=function(t){return d3.rgb(E(t.artist)).darker().toString()},D=function(t,r){var n;return n='<p class="main">'+t.name+"</span></p>",n+='<hr class="tooltip-hr">',n+='<p class="main">'+t.artist+"</span></p>",C.showTooltip(n,d3.event),g&&g.attr("stroke",function(r){return r.source===t||r.target===t?"#555":"#ddd"}).attr("stroke-opacity",function(r){return r.source===t||r.target===t?1:.5}),w.style("stroke",function(r){return r.searched||x(t,r)?"#555":q(r)}).style("stroke-width",function(r){return r.searched||x(t,r)?2:1}),d3.select(this).style("stroke","black").style("stroke-width",2)},d=function(t,r){return C.hideTooltip(),w.style("stroke",function(t){return t.searched?"#555":q(t)}).style("stroke-width",function(t){return t.searched?2:1}),g?g.attr("stroke","#ddd").attr("stroke-opacity",.8):void 0},m},n=function(t,r){return d3.selectAll("#"+t+" a").classed("active",!1),d3.select("#"+t+" #"+r).classed("active",!0)},$(function(){var r;return r=t(),d3.selectAll("#layouts a").on("click",function(t){var e;return e=d3.select(this).attr("id"),n("layouts",e),r.toggleLayout(e)}),d3.selectAll("#filters a").on("click",function(t){var e;return e=d3.select(this).attr("id"),n("filters",e),r.toggleFilter(e)}),d3.selectAll("#sorts a").on("click",function(t){var e;return e=d3.select(this).attr("id"),n("sorts",e),r.toggleSort(e)}),$("#song_select").on("change",function(t){var n;return n=$(this).val(),d3.json("data/"+n,function(t){return r.updateData(t)})}),$("#search").keyup(function(){var t;return t=$(this).val(),r.updateSearch(t)}),d3.json("data/sample.json",function(t){return r("#vis",t)})})}).call(this);